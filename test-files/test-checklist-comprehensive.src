/* Comprehensive test for all checklist items */

/* 4.1: Class declarations */
class TestClass {
};

/* 4.2: Data member declarations, 4.9: Integer and float variables */
/* 4.5: Private/Public visibility, 4.10: Array declarations */
class DataMemberTest {
  public attribute x : integer;
  public attribute y : float;
  private attribute arr : integer[10];
  private attribute matrix : float[5][5];
};

/* 4.3: Member function declarations */
class MemberFuncDeclTest {
  public function compute: (a: integer) => integer;
};

/* 4.4: Inheritance lists */
class Base {
  public attribute value : integer;
};

class Derived isa Base {
  public attribute extra : float;
};

/* 4.6: Free function definitions */
function freeFunc(n: integer) => integer
{
  localvar result : integer;
  result = n;
  return(result);
}

/* 4.7: Member function definitions (via constructor) */
class WithConstructor {
  private attribute data : integer;
  public constructor: (val: integer);
};

/* 4.8: Local variable declarations */
function testLocals() => void
{
  localvar a : integer;
  localvar b : float;
  localvar c : integer[3];
}

/* 4.11: If statements */
function testIf(x: integer) => void
{
  if (x == 5)
    then {
      write(x);
    }
    else {
      write(0);
    };
}

/* 4.12: While statements */
function testWhile(n: integer) => void
{
  localvar i : integer;
  i = 0;
  while (i < n) {
    write(i);
    i = i + 1;
  };
}

/* 4.13: Read/Write statements */
function testReadWrite() => void
{
  localvar x : integer;
  read(x);
  write(x);
}

/* 4.14: Return statements */
function testReturn(val: integer) => integer
{
  return(val + 1);
}

/* 4.15: Assignment statements */
function testAssignment() => void
{
  localvar x : integer;
  localvar y : float;
  x = 42;
  y = 3.14;
}

/* 4.16: Complex index structures with [] and () and expressions as indices */
function testComplexIndices() => void
{
  localvar arr : integer[10];
  localvar matrix : integer[5][5];
  localvar i : integer;
  localvar j : integer;
  
  i = 0;
  j = 1;
  
  arr[0] = 5;
  arr[i] = 10;
  arr[i + 1] = 15;
  arr[i + j] = 20;
  
  matrix[0][0] = 1;
  matrix[i][j] = 2;
  matrix[i + 1][j - 1] = 3;
  matrix[arr[i]][arr[j]] = 4;
}

/* 4.17: Complex expressions - all operators */
function testComplexExpressions(a: integer, b: integer) => integer
{
  localvar result : integer;
  localvar temp : integer;
  
  /* addop: +, -, or */
  result = a + b;
  result = a - b;
  result = a or b;
  
  /* multop: *, /, and */
  result = a * b;
  result = a / b;
  result = a and b;
  
  /* relop: ==, <>, <, >, <=, >= */
  if (a == b) then { result = 1; } else { result = 0; };
  if (a <> b) then { result = 1; } else { result = 0; };
  if (a < b) then { result = 1; } else { result = 0; };
  if (a > b) then { result = 1; } else { result = 0; };
  if (a <= b) then { result = 1; } else { result = 0; };
  if (a >= b) then { result = 1; } else { result = 0; };
  
  /* unaryop: +, -, not */
  result = +a;
  result = -a;
  result = not a;
  
  /* Nested expressions with precedence */
  result = a + b * 2 - 3 / 1;
  result = (a + b) * (2 - 3);
  
  return(result);
}

/* 4.17: idnest (member access) and function calls */
class Point {
  public attribute x : integer;
  public attribute y : integer;
  public function distance: (other: Point) => float;
};

function testMemberAccessAndCalls() => void
{
  localvar p : Point;
  localvar q : Point;
  localvar dist : float;
  
  /* Member access */
  p.x = 10;
  p.y = 20;
  
  /* Member function call */
  dist = p.distance(q);
  
  /* Free function call */
  write(freeFunc(42));
}

/* Main entry point */
function main() => void
{
  testIf(5);
  testWhile(10);
  testReadWrite();
  write(testReturn(99));
  testAssignment();
  testComplexIndices();
  write(testComplexExpressions(10, 20));
  testMemberAccessAndCalls();
}
